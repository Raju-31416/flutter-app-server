"use strict";
const request = require("request");
const getContacts = function() {
	const param = this;
	const isvServer = param.isvServer.replace(new RegExp("/+$"), "");
	const option = {
		url: `${isvServer}/contacts`,
		method: "post",
		json: true,
		body: {
			suiteKey: param.suiteKey,
			suiteSecret: param.suiteSecret,
			orgId: param.orgId,
			domainId: param.domainId
		}
	};
	return new Promise((success, fail) => {
		const handleServerResponse = function(body) {
			if (body.status === "ok") {
				success(body.results);
			} else {
				fail(body);
			}
		};
		request(option, (e, res, body) => {
			if (e) {
				console.error("网络错误", e);
				return Promise.reject(e);
			} else {
				handleServerResponse(body);
			}
		});
	});
};
const getInstance = function(param) {
	return {
		getContacts: getContacts.bind(param)
	};
};
module.exports = getInstance;